#!/bin/bash

# ุณูุฑูุจุช ุงูุชุซุจูุช ุงูุชููุงุฆู ูู DIPS Academy
# ูุฃูุธูุฉ Unix/Linux/macOS

echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ                                                           โ"
echo "โ        ๐ DIPS Academy - ุณูุฑูุจุช ุงูุชุซุจูุช ุงูุชููุงุฆู        โ"
echo "โ                                                           โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# ุฃููุงู
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# ุงูุชุญูู ูู ุงููุชุทูุจุงุช
echo "๐ ุงูุชุญูู ูู ุงููุชุทูุจุงุช ุงูุฃุณุงุณูุฉ..."
echo ""

# PHP
if ! command -v php &> /dev/null; then
    echo -e "${RED}โ ุฎุทุฃ: PHP ุบูุฑ ูุซุจุช${NC}"
    exit 1
fi
echo -e "${GREEN}โ PHP: $(php -v | head -n 1)${NC}"

# Composer
if ! command -v composer &> /dev/null; then
    echo -e "${RED}โ ุฎุทุฃ: Composer ุบูุฑ ูุซุจุช${NC}"
    exit 1
fi
echo -e "${GREEN}โ Composer: ูุซุจุช${NC}"

# Node
if ! command -v node &> /dev/null; then
    echo -e "${RED}โ ุฎุทุฃ: Node.js ุบูุฑ ูุซุจุช${NC}"
    exit 1
fi
echo -e "${GREEN}โ Node.js: $(node -v)${NC}"

echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# ุจุฏุก ุงูุชุซุจูุช
echo "๐ ุจุฏุก ุนูููุฉ ุงูุชุซุจูุช..."
echo ""

# 1. Composer
echo "๐ฆ [1/9] ุชุซุจูุช ุชุจุนูุงุช PHP (Composer)..."
composer install
if [ $? -ne 0 ]; then
    echo -e "${RED}โ ูุดู ุชุซุจูุช ุชุจุนูุงุช Composer${NC}"
    exit 1
fi
echo -e "${GREEN}โ ุชู ุชุซุจูุช ุชุจุนูุงุช PHP ุจูุฌุงุญ${NC}"
echo ""

# 2. NPM
echo "๐ฆ [2/9] ุชุซุจูุช ุชุจุนูุงุช JavaScript (NPM)..."
npm install
echo -e "${GREEN}โ ุชู ุชุซุจูุช ุชุจุนูุงุช JavaScript${NC}"
echo ""

# 3. .env
echo "โ๏ธ  [3/9] ุฅุนุฏุงุฏ ููู ุงูุจูุฆุฉ (.env)..."
if [ ! -f .env ]; then
    cp .env.example .env
    echo -e "${GREEN}โ ุชู ูุณุฎ .env.example ุฅูู .env${NC}"
else
    echo -e "${YELLOW}โน๏ธ  ููู .env ููุฌูุฏ ุจุงููุนู${NC}"
fi
echo ""

# 4. Key Generate
echo "๐ [4/9] ุชูููุฏ ููุชุงุญ ุงูุชุทุจูู..."
php artisan key:generate
echo -e "${GREEN}โ ุชู ุชูููุฏ ููุชุงุญ ุงูุชุทุจูู${NC}"
echo ""

# 5. Database
echo "๐๏ธ  [5/9] ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช..."
DB_NAME=$(grep DB_DATABASE .env | cut -d '=' -f2)
echo "๐ ุงุณู ูุงุนุฏุฉ ุงูุจูุงูุงุช: ${DB_NAME}"

# ูุญุงููุฉ ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช
mysql -u root -e "CREATE DATABASE IF NOT EXISTS ${DB_NAME} CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;" 2>/dev/null
if [ $? -eq 0 ]; then
    echo -e "${GREEN}โ ุชู ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช${NC}"
else
    echo -e "${YELLOW}โ๏ธ  ูุฑุฌู ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฏููุงู: ${DB_NAME}${NC}"
fi
echo ""

# 6. Migrations
echo "๐ [6/9] ุชุดุบูู Migrations..."
php artisan migrate --seed
if [ $? -ne 0 ]; then
    echo -e "${RED}โ ูุดู ุชุดุบูู Migrations${NC}"
    exit 1
fi
echo -e "${GREEN}โ ุชู ุชุดุบูู Migrations ุจูุฌุงุญ${NC}"
echo ""

# 7. Filament
echo "๐ [7/9] ูุดุฑ ูููุงุช Filament..."
php artisan filament:install --panels
echo -e "${GREEN}โ ุชู ูุดุฑ ูููุงุช Filament${NC}"
echo ""

# 8. Storage Link
echo "๐ [8/9] ุฑุจุท ูุฌูุฏ ุงูุชุฎุฒูู..."
php artisan storage:link
echo -e "${GREEN}โ ุชู ุฑุจุท ูุฌูุฏ ุงูุชุฎุฒูู${NC}"
echo ""

# 9. Build Assets
echo "๐จ [9/9] ุจูุงุก Assets..."
npm run build
echo -e "${GREEN}โ ุชู ุจูุงุก Assets ุจูุฌุงุญ${NC}"
echo ""

# ุงูุงูุชูุงุก
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ                                                           โ"
echo "โ          ๐ ุชู ุชุซุจูุช ุงููุดุฑูุน ุจูุฌุงุญ! ๐                   โ"
echo "โ                                                           โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# ูุนูููุงุช ุงููุตูู
echo "๐ ูุนูููุงุช ูุงูุฉ:"
echo ""
echo "๐ ุงููููุน: http://localhost:8000"
echo "๐ ููุญุฉ ุงูุชุญูู: http://localhost:8000/admin"
echo ""
echo "๐ค ุจูุงูุงุช ุงูุฏุฎูู:"
echo "   Super Admin:"
echo "   - ุงูุจุฑูุฏ: superadmin@dips-academy.com"
echo "   - ูููุฉ ุงููุฑูุฑ: password"
echo ""

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ:"
echo ""
echo "1. ุดุบูู ุงูุฎุงุฏู: php artisan serve"
echo "2. ุงูุชุญ ุงููุชุตูุญ: http://localhost:8000"
echo "3. ุงูุฑุฃ ุงูุชูุซูู: README.md"
echo ""

echo "๐ ุดูุฑุงู ูุงุณุชุฎุฏุงู DIPS Academy!"
echo "๐ ุตููุน ุจุญุจ ุจูุงุณุทุฉ OMAR HAJJOUB"
echo ""

# ุณุคุงู ุนู ุชุดุบูู ุงูุฎุงุฏู
read -p "โ ูู ุชุฑูุฏ ุชุดุบูู ุฎุงุฏู ุงูุชุทููุฑ ุงูุขูุ (y/n): " answer
if [ "$answer" = "y" ] || [ "$answer" = "Y" ]; then
    echo ""
    echo "๐ ุฌุงุฑู ุชุดุบูู ุฎุงุฏู ุงูุชุทููุฑ..."
    echo "๐ ุงููููุน: http://localhost:8000"
    echo "โน๏ธ  ุงุถุบุท Ctrl+C ูุฅููุงู ุงูุฎุงุฏู"
    echo ""
    php artisan serve
else
    echo ""
    echo "โ ููููู ุชุดุบูู ุงูุฎุงุฏู ูุงุญูุงู ุจุงุณุชุฎุฏุงู: php artisan serve"
    echo ""
fi
